"use strict";(self["webpackChunkquasarapp"]=self["webpackChunkquasarapp"]||[]).push([[953],{953:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ke});var n=a(3673);const o={class:"q-py-lg"},t={class:"row"},s={class:"col-12 q-px-sm"};function i(e,l,a,i,d,r){const c=(0,n.up)("tree-view-meals"),m=(0,n.up)("q-drawer"),u=(0,n.up)("planning"),p=(0,n.up)("q-btn"),g=(0,n.up)("q-page-sticky"),h=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(h,{class:"q-pa-md"},{default:(0,n.w5)((()=>[(0,n.Wm)("div",o,[(0,n.Wm)(m,{modelValue:i.leftDrawerTreeViewOpen,"onUpdate:modelValue":l[1]||(l[1]=e=>i.leftDrawerTreeViewOpen=e),id:"tree",ref:"tree","show-if-above":"",bordered:"",class:"bg-grey-1 q-pa-md"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{onTouchstart:i.touchstart,onMousedown:i.mousedown,onMouseup:i.mouseup},null,8,["onTouchstart","onMousedown","onMouseup"])])),_:1},8,["modelValue"]),(0,n.Wm)("div",t,[(0,n.Wm)("div",s,[(0,n.Wm)(u)])])]),(0,n.Wm)(g,{position:"bottom-right",offset:[18,18]},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{fab:"",icon:"add",color:"primary",onClick:i.toggleLeftDrawerTreeView},null,8,["onClick"])])),_:1})])),_:1})}var d=a(1959),r=a(2323);const c=(0,n.HX)("data-v-54531317");(0,n.dD)("data-v-54531317");const m={id:"TreeViewMeals"},u=(0,n.Wm)("h4",{class:"text-center q-ma-none"},"Platos",-1),p=(0,n.Wm)("div",{class:"q-py-md"},null,-1),g={class:"row no-wrap items-end"},h={class:"col-8"},w={class:"col-4 q-ml-sm"},v={class:"row q-mt-md"},y={class:"col-12"},f={class:"row items-center justify-between full-width"},k={class:"text-weight-medium text-h6",color:"primary"},_={class:"\n\t\t\t\t\t\t\t\t\t\t\t\t\thandle\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext-black text-left\n\t\t\t\t\t\t\t\t\t\t\t\t\tbg-transparent\n\t\t\t\t\t\t\t\t\t\t\t\t"};(0,n.Cn)();const W=c(((e,l,a,o,t,s)=>{const i=(0,n.up)("q-icon"),d=(0,n.up)("q-input"),W=(0,n.up)("q-btn"),b=(0,n.up)("draggable"),q=(0,n.up)("q-tree");return(0,n.wg)(),(0,n.j4)("div",m,[u,p,(0,n.Wm)("div",g,[(0,n.Wm)("div",h,[(0,n.Wm)(d,{ref:"filterRef",modelValue:o.filter,"onUpdate:modelValue":l[1]||(l[1]=e=>o.filter=e),label:"Filter",onKeyup:o.openOrCloseTree},{append:c((()=>[""!==o.filter?((0,n.wg)(),(0,n.j4)(i,{key:0,name:"clear",class:"cursor-pointer",onClick:o.resetFilter},null,8,["onClick"])):(0,n.kq)("",!0)])),_:1},8,["modelValue","onKeyup"])]),(0,n.Wm)("div",w,[(0,n.Wm)(W,{class:"btnCollapseOpen",push:"",dense:"",color:"primary",label:o.collapseOpen,onClick:o.toogleTree},null,8,["label","onClick"])])]),(0,n.Wm)("div",v,[(0,n.Wm)("div",y,[(0,n.Wm)(q,{ref:"tree",nodes:o.categories,"node-key":"name","label-key":"name","children-key":"meals","v-model":o.expandedKeys,filter:o.filter,"default-expand":""},{"default-header":c((e=>[(0,n.Wm)("div",f,["undefined"===typeof e.node.category_id?((0,n.wg)(),(0,n.j4)(n.HY,{key:0},[(0,n.Wm)("span",k,(0,r.zw)(e.node.name),1),(0,n.Wm)(i,{class:"col-2 q-py-sm",name:e.node.icon.path?"img:"+e.node.icon.path:""},null,8,["name"])],64)):((0,n.wg)(),(0,n.j4)(b,{key:1,list:[e],"item-key":e.node.name,group:{name:"meals",pull:"clone",put:!1}},{item:c((({element:e})=>[(0,n.Wm)("div",_,(0,r.zw)(e.node.name),1)])),_:2},1032,["list","item-key"]))])])),_:1},8,["nodes","v-model","filter"])])])])}));var b=a(5474),q=a(470),x=a.n(q);const T={name:"TreeViewMeals",components:{draggable:x()},setup(){(0,n.f3)("emitter");const e=(0,d.iH)([]),l=(0,d.iH)(!0),a=(0,d.iH)(!1),o=(0,d.iH)([]),t=(0,d.iH)("Abrir todos"),s=(0,d.iH)(""),i=(0,d.iH)(null),r=(0,d.iH)(null);(0,n.wF)((()=>{c()}));const c=async()=>{await b.api.get("https://back-food-planning.herokuapp.com/api/categories").then((e=>{o.value=e.data.categories}))},m=()=>{r.value.getExpandedNodes().length>0?g():h()},u=()=>{""==s.value?g():h()},p=()=>{g(),s.value="",i.value.focus()},g=()=>{r.value.collapseAll(),t.value="Abrir\ntodos"},h=()=>{r.value.expandAll(),t.value="Cerrar\ntodos"};return{expandedKeys:e,isExpanded:l,dragging:a,filter:s,filterRef:i,resetFilter:p,collapseOpen:t,toogleTree:m,categories:o,tree:r,openOrCloseTree:u}}};var C=a(4842),H=a(4554),P=a(8240),j=a(5078),M=a(7518),A=a.n(M);T.render=W,T.__scopeId="data-v-54531317";const Z=T;A()(T,"components",{QInput:C.Z,QIcon:H.Z,QBtn:P.Z,QTree:j.Z});a(71);var D=a(8880);const Q=(0,n.HX)("data-v-62908782");(0,n.dD)("data-v-62908782");const V={"q-pa-md":""},I={class:"row justify-between q-mt-sm"},O={key:0,class:"q-my-sm"},E={class:"row justify-evenly"},z={class:"text-h6 q-ml-sm"},B={class:""},F={class:"row justify-evenly q-mt-md"},K={class:"row items-baseline justify-between"},S={class:"col text-black text-left text-h4"},U={class:"col text-right"},R=(0,n.Uk)(" Añadir plato (en este día y hora) "),$={class:"q-ml-xs q-mt-xs"},Y={class:"row items-center justify-between q-my-sm"},N={class:"col-8 q-pl-sm"},L=(0,n.Uk)(" Eliminar ");(0,n.Cn)();const X=Q(((e,l,a,o,t,s)=>{const i=(0,n.up)("q-toggle"),d=(0,n.up)("q-btn"),c=(0,n.up)("q-btn-group"),m=(0,n.up)("q-avatar"),u=(0,n.up)("q-card-section"),p=(0,n.up)("q-icon"),g=(0,n.up)("q-separator"),h=(0,n.up)("q-card"),w=(0,n.up)("q-expansion-item"),v=(0,n.up)("q-tooltip"),y=(0,n.up)("q-item-section"),f=(0,n.up)("q-item"),k=(0,n.up)("q-list"),_=(0,n.up)("q-menu"),W=(0,n.up)("draggable"),b=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.j4)("div",V,[(0,n.Wm)("h3",{onClick:l[1]||(l[1]=(...e)=>o.saluda&&o.saluda(...e)),class:"text-center q-mt-none q-mb-md"},"Planning"),(0,n.Wm)("h3",{onClick:l[2]||(l[2]=(...e)=>o.calcNumAssignedMealsForType&&o.calcNumAssignedMealsForType(...e)),class:"text-center q-mt-none q-mb-md"},"Test"),(0,n.Wm)("div",I,[(0,n.Wm)(i,{class:"col",modelValue:o.showResume,"onUpdate:modelValue":l[3]||(l[3]=e=>o.showResume=e),label:"Ver resumen",onClick:o.calcNumAssignedMealsForType},null,8,["modelValue","onClick"]),(0,n.Wm)(c,{push:"",class:"col",style:{"max-width":"400px"}},{default:Q((()=>[(0,n.Wm)(d,{class:"col q-pa-none",push:"",icon:"west",onClick:l[4]||(l[4]=e=>o.getPlanningDB(-1))}),(0,n.Wm)(d,{class:"col q-pa-none",push:"",label:"Hoy",icon:"today",onClick:l[5]||(l[5]=e=>o.getPlanningDB())}),(0,n.Wm)(d,{class:"col q-pa-none",push:"",icon:"east",onClick:l[6]||(l[6]=e=>o.getPlanningDB(1))})])),_:1})]),o.showResume?((0,n.wg)(),(0,n.j4)("div",O,[(0,n.Wm)(w,{id:"resumeMeals",modelValue:o.showResume,"onUpdate:modelValue":l[7]||(l[7]=e=>o.showResume=e),dense:"","dense-toggle":""},{default:Q((()=>[(0,n.Wm)("div",E,[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(o.mealTypes.filter((e=>!e.general)),(e=>((0,n.wg)(),(0,n.j4)("div",{key:e.id,class:"col-12 col-sm-5 planning-card"},[(0,n.Wm)(h,null,{default:Q((()=>[(0,n.Wm)(u,{class:"row"},{default:Q((()=>[(0,n.Wm)(m,{style:`width:0.7em; height:0.7em; background-color:${e.color}; border: 1px solid #d4d4d4;`},null,8,["style"]),(0,n.Wm)("div",z,(0,r.zw)(e.name),1)])),_:2},1024),(0,n.Wm)(u,null,{default:Q((()=>[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(o.categories,(l=>{var a;return(0,n.wg)(),(0,n.j4)("div",{key:l.id},[(0,n.Wm)("div",B,[(0,n.Wm)(p,{class:"meal-category-icons q-mr-sm",name:l.icon.path?"img:"+l.icon.path:""},null,8,["name"]),(0,n.Wm)("span",{class:o.mealTypesAssigned[e.id][l.id]<l.optimum_number?"text-red-6":"text-blue-6"},(0,r.zw)(l.name)+": "+(0,r.zw)(null!==(a=o.mealTypesAssigned[e.id][l.id])&&void 0!==a?a:0)+" / "+(0,r.zw)(l.optimum_number),3)])])})),128))])),_:2},1024),(0,n.Wm)(g,{dark:""})])),_:2},1024)])))),128))])])),_:1},8,["modelValue"])])):(0,n.kq)("",!0),(0,n.Wm)("div",F,[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(o.planning,((e,a)=>((0,n.wg)(),(0,n.j4)("div",{class:"col-12 col-sm-5 col-lg-3 col-xl-auto planning-card q-pt-md q-px-md",key:`day-${a}`},[(0,n.Wm)("div",K,[(0,n.Wm)("span",S,(0,r.zw)(e.name),1),(0,n.Wm)("span",U,(0,r.zw)(e.date),1)]),((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(e.hours,((e,t)=>((0,n.wg)(),(0,n.j4)("div",{key:`div-mealHourId-${e.id}`,class:"q-ml-xs"},[(0,n.Wm)("div",{class:"text-h6 text-left meal-hours-tittle",style:[{font:"size 1.35rem"},t>0?"margin-top: -20px;":"margin-top: 10px;"],onClick:l[8]||(l[8]=e=>o.seeAllPlanningInConsole("mealHour"))},[(0,n.Wm)("span",null,(0,r.zw)(e.name),1),(0,n.Wm)(p,{class:"q-ml-md",name:"add_circle_outline"},{default:Q((()=>[(0,n.Wm)(v,null,{default:Q((()=>[R])),_:1})])),_:1})],4),(0,n.Wm)("div",$,[(0,n.Wm)(W,{list:e.meals,handle:".handle","item-key":`mealHourId-${e.id}`,group:"meals",class:"q-pb-xl",onAdd:l=>o.addDragging(a,e.id,t),onChange:o.changeDragging,options:{delay:2e3}},{item:Q((({element:e})=>{var l;return[(0,n.Wm)("div",Y,[(0,n.Wm)(p,{class:"meal-category-icons handle",name:e.icon_path?"img:"+e.icon_path:""},{default:Q((()=>[(0,n.Wm)(v,null,{default:Q((()=>[(0,n.Uk)((0,r.zw)(e.category_name||"Sin categoría"),1)])),_:2},1024)])),_:2},1032,["name"]),(0,n.Wm)("span",N,(0,r.zw)(null!==(l=e.name)&&void 0!==l?l:e.node.name),1),(0,n.Wm)(m,{style:`cursor:pointer; width:0.5em; height:0.5em; background-color:${e.meal_type_color}; border: 1px solid #d4d4d4;`},{default:Q((()=>[(0,n.Wm)(v,null,{default:Q((()=>[(0,n.Uk)((0,r.zw)(e.meal_type_name||"Sin tipo"),1)])),_:2},1024),(0,n.wy)((0,n.Wm)(_,null,{default:Q((()=>[(0,n.Wm)(k,{style:{"min-width":"100px"}},{default:Q((()=>[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(o.mealTypes,(l=>(0,n.wy)(((0,n.wg)(),(0,n.j4)(f,{clickable:"",onClick:n=>o.updateMealType(e,a,t,l),key:`div-mealTypeId-${l.id}`,class:"items-center"},{default:Q((()=>[(0,n.Wm)(y,{avatar:"",style:{"min-width":"initial"}},{default:Q((()=>[(0,n.Wm)(m,{style:`width:0.7em; height:0.7em; background-color:${l.color}; border: 1px solid #d4d4d4;`},null,8,["style"])])),_:2},1024),(0,n.Wm)(y,null,{default:Q((()=>[(0,n.Uk)((0,r.zw)(l.name),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[b]]))),128))])),_:2},1024)])),_:2},1536),[[D.F8,o.viewMenuMealTypes]])])),_:2},1032,["style"]),(0,n.Wm)(p,{class:"meal-remove-icons",name:"clear",onClick:l=>o.removeMealPlanningDB(e,t)},{default:Q((()=>[(0,n.Wm)(v,null,{default:Q((()=>[L])),_:1})])),_:2},1032,["onClick"])])]})),_:2},1032,["list","item-key","onAdd","onChange"])])])))),128))])))),128))]),(0,n.Wm)("button",{onClick:l[9]||(l[9]=(...e)=>o.seeAllPlanningInConsole&&o.seeAllPlanningInConsole(...e))},"See All Planning"),(0,n.Wm)("button",{onClick:l[10]||(l[10]=(...e)=>o.deleteAllPlanning&&o.deleteAllPlanning(...e))},"Delete All Planning")])}));var G=a(515),J=a.n(G),ee=(a(9544),a(8825));const le={name:"Planning",components:{draggable:x()},setup(){let e=(0,d.iH)({}),l=(0,d.iH)([]),a=(0,d.iH)([]),o=(0,d.iH)([]),t=(0,d.iH)(!1),s={},i=(0,d.iH)(!1),r=(0,d.iH)(0);const c=(0,ee.Z)();let m=(0,d.iH)({});(0,n.wF)((()=>{u()}));const u=async(n=0)=>{(n||r.value||!Object.keys(e.value).length)&&(c.loading.show(),r.value=n?r.value+n:0,await b.api.post("https://back-food-planning.herokuapp.com/api/planning",{weekDiff:r.value}).then((n=>{e.value=n.data.planning,l.value=n.data.mealTypes,a.value=n.data.mealHours,o.value=n.data.categories})).catch((()=>{})).finally((()=>{c.loading.hide()})))},p=(e,l=!0)=>{let a=o.value.findIndex((l=>l.id==e.category_id));-1!=a&&(o.value[a].assigned=null!=o.value[a].assigned?l?++o.value[a].assigned:--o.value[a].assigned:1)},g=e=>{_(e)?(s=k(e)?J()({},e.added.element):J()({},e.added.element.node),s.order=e.added.newIndex+1):W(e)?(s=J()({},e.moved.element),s.order=e.moved.newIndex+1,y()):f(e.removed.element)},h=(l,a,n)=>{console.log("addDragging dragging Planning...",l,a,n),s.day_of_week=l,s.meal_hour_id=a,s.date=e.value[l].date,w(n)},w=async l=>{c.loading.show(),await b.api.post("https://back-food-planning.herokuapp.com/api/planningStore",s).then((a=>{e.value[s.day_of_week]["hours"][l]["meals"]=a.data,p(s)})).catch((e=>{console.log(e)})).finally((()=>{H()})),c.loading.hide()},v=l=>{let a;return e.value[l.day_of_week]["hours"].forEach(((e,n)=>{e.id==l.meal_hour_id&&(a=n)})),a},y=async()=>{c.loading.show();let l=v(s);await b.api.post("https://back-food-planning.herokuapp.com/api/update-order-planning",s).then((a=>{e.value[s.day_of_week]["hours"][l]["meals"]=a.data})).catch((e=>{console.log(e)})),c.loading.hide()},f=async(l,a=null)=>{console.log("Click remove"),c.loading.show(),null===a&&(a=v(l)),await b.api.delete("https://back-food-planning.herokuapp.com/api/planning/"+l.id).then((n=>{e.value[l.day_of_week]["hours"][a]["meals"]=n.data,p(l,!1)})).catch((e=>{console.error(e)})).finally((()=>{H()})),c.loading.hide()},k=e=>!e.added.element.hasOwnProperty("key"),_=e=>e.hasOwnProperty("added"),W=e=>e.hasOwnProperty("moved"),q=(l="")=>{alert("click en "+l),console.log("All Planning",e.value)},x=async()=>{await b.api.delete("https://back-food-planning.herokuapp.com/api/delete-all-planning").then((l=>{e.value=l.data.planning,o.value.forEach((e=>{e.assigned=0}))})).catch((e=>{console.error(e)})).finally((()=>{H()}))},T=async(l,a,n,o)=>{console.log("Entra en updateMealType"),l.meal_type_id=o.id,l.meal_type_color=o.color;let t=e.value[a]["hours"][n]["meals"].indexOf(l);await b.api.post("https://back-food-planning.herokuapp.com/api/updateMealType",l).then((o=>{e.value[a]["hours"][n]["meals"][t]=l})).catch((e=>{console.error(e)})).finally((()=>{H()}))},C=()=>{let l=[];console.log("----");for(const a of Object.values(e.value))console.log(a);console.log("----"),Object.values(e.value).forEach((e=>{e.hours.forEach((e=>{e.meals.forEach((e=>{l.push(e)}))}))})),console.log("----"),console.log(l)},H=()=>{if(!t.value)return;const e=P();let a={};o.value.forEach((e=>{a[e.id]=0})),l.value.forEach((e=>{e.general||(m.value[e.id]=J()({},a))})),e.forEach((e=>{m.value.hasOwnProperty(e.meal_type_id)?m.value[e.meal_type_id][e.category_id]++:Object.keys(m.value).forEach((l=>{m.value[l][e.category_id]=m.value[l][e.category_id]+1}))}))},P=()=>{let l=[];return Object.values(e.value).forEach((e=>{e.hours.forEach((e=>{e.meals.forEach((e=>{l.push(e)}))}))})),l};return{planning:e,mealTypes:l,mealHours:a,categories:o,showResume:t,seeAllPlanningInConsole:q,deleteAllPlanning:x,addDragging:h,changeDragging:g,removeMealPlanningDB:f,weekDiff:r,getPlanningDB:u,updateMealType:T,saluda:C,viewMenuMealTypes:i,calcNumAssignedMealsForType:H,mealTypesAssigned:m}}};var ae=a(8886),ne=a(6375),oe=a(429),te=a(151),se=a(5589),ie=a(5096),de=a(5869),re=a(8870),ce=a(811),me=a(7011),ue=a(3414),pe=a(2035),ge=a(677);le.render=X,le.__scopeId="data-v-62908782";const he=le;A()(le,"components",{QToggle:ae.Z,QBtnGroup:ne.Z,QBtn:P.Z,QExpansionItem:oe.Z,QCard:te.Z,QCardSection:se.Z,QAvatar:ie.Z,QIcon:H.Z,QSeparator:de.Z,QTooltip:re.Z,QMenu:ce.Z,QList:me.Z,QItem:ue.Z,QItemSection:pe.Z}),A()(le,"directives",{ClosePopup:ge.Z});const we={name:"PlanningPage",components:{TreeViewMeals:Z,Planning:he},setup(){let e=(0,d.iH)(!1),l="",a=(0,n.f3)("emitter");const o=(0,ee.Z)();(0,n.bv)((()=>{a.on("closeTreeViewMealsDrawer",(()=>{e.value=!1}))}));const t=()=>{e.value=!e.value,a.emit("updateLeftDrawerTreeViewOpen",e.value)},s=()=>{console.log("Touch start"),l="mousedown",c()},i=()=>{console.log("Mouse down"),l="mousedown",c()},r=()=>{console.log("Mouse up"),l="mouseup"},c=()=>{console.log("checklastMouse"),console.log("Is mobile?",o.platform.is.mobile),console.log("Screen",o.screen),console.log("Is small?",o.screen.xs,o.screen.sm),(o.screen.xs||o.screen.sm)&&window.setTimeout((()=>{console.log("checklastMouse"),"mousedown"==l&&t()}),1e3)};return{leftDrawerTreeViewOpen:e,toggleLeftDrawerTreeView:t,touchstart:s,mousedown:i,mouseup:r}}};var ve=a(4379),ye=a(2901),fe=a(1007);we.render=i;const ke=we;A()(we,"components",{QPage:ve.Z,QDrawer:ye.Z,QPageSticky:fe.Z,QBtn:P.Z})}}]);